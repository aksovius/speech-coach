"use strict";(self.webpackChunkspeech_coach_docs=self.webpackChunkspeech_coach_docs||[]).push([[7956],{8453:(e,n,i)=>{i.d(n,{R:()=>a,x:()=>t});var s=i(6540);const r={},l=s.createContext(r);function a(e){const n=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),s.createElement(l.Provider,{value:n},e.children)}},8704:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>h,frontMatter:()=>a,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"architecture/challenges","title":"Technical Challenges","description":"Building Speech Coach presented several architectural and infrastructure challenges, especially when balancing real-time feedback, scalability, and system resilience.","source":"@site/docs/architecture/challenges.md","sourceDirName":"architecture","slug":"/architecture/challenges","permalink":"/docs/architecture/challenges","draft":false,"unlisted":false,"editUrl":"https://github.com/aksovius/speech-coach/tree/main/docs-site/docs/architecture/challenges.md","tags":[],"version":"current","frontMatter":{"id":"challenges","title":"Technical Challenges","sidebar_label":"Challenges"}}');var r=i(4848),l=i(8453);const a={id:"challenges",title:"Technical Challenges",sidebar_label:"Challenges"},t="\ud83e\uddd7 Technical Challenges",o={},c=[{value:"1. Webhook Handling at Scale",id:"1-webhook-handling-at-scale",level:2},{value:"2. FastAPI Scalability: Horizontal vs Vertical",id:"2-fastapi-scalability-horizontal-vs-vertical",level:2},{value:"\ud83d\udd01 Vertical Scaling (Deep)",id:"-vertical-scaling-deep",level:3},{value:"\ud83c\udf10 Horizontal Scaling (Wide)",id:"-horizontal-scaling-wide",level:3},{value:"3. Stream-Based Audio Processing",id:"3-stream-based-audio-processing",level:2},{value:"\u2699\ufe0f Preprocessing Optimizations",id:"\ufe0f-preprocessing-optimizations",level:4},{value:"4. AI Feedback Latency &amp; Rate Limits",id:"4-ai-feedback-latency--rate-limits",level:2},{value:"\ud83c\udf10 Future Improvement: API Failover",id:"-future-improvement-api-failover",level:4},{value:"This strategy would reduce single-point-of-failure risks and support continuous operation in production environments.",id:"this-strategy-would-reduce-single-point-of-failure-risks-and-support-continuous-operation-in-production-environments",level:2},{value:"5. Real-Time Analytics Pipeline",id:"5-real-time-analytics-pipeline",level:2},{value:"\ud83d\udca1 Tech Stack Rationale",id:"-tech-stack-rationale",level:4},{value:"This setup allows for tight integration, faster development, and easier onboarding for Python engineers.",id:"this-setup-allows-for-tight-integration-faster-development-and-easier-onboarding-for-python-engineers",level:2},{value:"6. Scalability &amp; Future-Proofing",id:"6-scalability--future-proofing",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",p:"p",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"-technical-challenges",children:"\ud83e\uddd7 Technical Challenges"})}),"\n",(0,r.jsxs)(n.p,{children:["Building ",(0,r.jsx)(n.strong,{children:"Speech Coach"})," presented several architectural and infrastructure challenges, especially when balancing real-time feedback, scalability, and system resilience."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"1-webhook-handling-at-scale",children:"1. Webhook Handling at Scale"}),"\n",(0,r.jsxs)(n.p,{children:["Telegram supports only ",(0,r.jsx)(n.strong,{children:"one webhook endpoint per bot"}),", making horizontal scaling non-trivial."]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Initially, a single ",(0,r.jsx)(n.strong,{children:"FastAPI"})," instance handles all webhooks."]}),"\n",(0,r.jsxs)(n.li,{children:["To support multiple instances, a load balancer such as ",(0,r.jsx)(n.strong,{children:"NGINX"})," or ",(0,r.jsx)(n.strong,{children:"HAProxy"})," is required."]}),"\n",(0,r.jsx)(n.li,{children:"Redis is used to share session or state across instances."}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"2-fastapi-scalability-horizontal-vs-vertical",children:"2. FastAPI Scalability: Horizontal vs Vertical"}),"\n",(0,r.jsxs)(n.p,{children:["There are two main strategies to scale the ",(0,r.jsx)(n.strong,{children:"FastAPI"})," app:"]}),"\n",(0,r.jsx)(n.h3,{id:"-vertical-scaling-deep",children:"\ud83d\udd01 Vertical Scaling (Deep)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["You can increase the number of ",(0,r.jsx)(n.strong,{children:"Gunicorn workers"})," per instance to leverage multiple CPU cores."]}),"\n",(0,r.jsx)(n.li,{children:"This increases throughput on a single node."}),"\n",(0,r.jsxs)(n.li,{children:["However, state (e.g., session cache) must be ",(0,r.jsx)(n.strong,{children:"shared across worker processes"})," \u2014 Redis is planned for this purpose."]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"-horizontal-scaling-wide",children:"\ud83c\udf10 Horizontal Scaling (Wide)"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Deploy ",(0,r.jsx)(n.strong,{children:"multiple FastAPI servers"})," across different nodes or containers."]}),"\n",(0,r.jsxs)(n.li,{children:["Use a ",(0,r.jsx)(n.strong,{children:"HAProxy cluster"})," in front to distribute traffic across instances."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redis"})," should be clustered (2\u20133 nodes) to ensure ",(0,r.jsx)(n.strong,{children:"shared state and high availability"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"To further increase fault tolerance:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Set up ",(0,r.jsx)(n.strong,{children:"PostgreSQL in HA mode"})," using ",(0,r.jsx)(n.strong,{children:"Patroni + etcd"})," or a similar orchestrator."]}),"\n",(0,r.jsx)(n.li,{children:"This ensures automatic failover and seamless recovery in case of DB outages."}),"\n",(0,r.jsxs)(n.li,{children:["HAProxy can also route database traffic to the active ",(0,r.jsx)(n.strong,{children:"PostgreSQL leader"}),"."]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"3-stream-based-audio-processing",children:"3. Stream-Based Audio Processing"}),"\n",(0,r.jsx)(n.p,{children:"Handling voice messages asynchronously and reliably required careful orchestration:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Used ",(0,r.jsx)(n.strong,{children:"Redis Streams + FastStream"})," for async job dispatch"]}),"\n",(0,r.jsx)(n.li,{children:"Workers are isolated, stateless, and can be scaled independently"}),"\n",(0,r.jsx)(n.li,{children:"Includes retry mechanisms for OpenAI API failures or network issues"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\ufe0f-preprocessing-optimizations",children:"\u2699\ufe0f Preprocessing Optimizations"}),"\n",(0,r.jsx)(n.p,{children:"To reduce processing time and API costs, several audio preprocessing steps were introduced:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Downsampling audio"})," (e.g., 48kHz \u2192 16kHz) to reduce file size without loss of quality for transcription"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Silence removal"})," to skip unspoken segments and reduce duration"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Playback speed-up"})," (e.g., 2\xd7) to minimize audio length before sending to the API"]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These techniques significantly improve throughput and reduce expenses when working with usage-billed APIs like Whisper or GPT."}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"4-ai-feedback-latency--rate-limits",children:"4. AI Feedback Latency & Rate Limits"}),"\n",(0,r.jsxs)(n.p,{children:["Using ",(0,r.jsx)(n.strong,{children:"OpenAI Whisper + GPT-4"})," in real-time brings both benefits and limitations:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Transcription is fast, but GPT-4 generation can be slow under load"}),"\n",(0,r.jsxs)(n.li,{children:["To mitigate latency:","\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Workers handle generation off-main thread"}),"\n",(0,r.jsxs)(n.li,{children:["A future plan includes ",(0,r.jsx)(n.strong,{children:"dedicated GPT workers"})," to offload feedback generation"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"-future-improvement-api-failover",children:"\ud83c\udf10 Future Improvement: API Failover"}),"\n",(0,r.jsxs)(n.p,{children:["To improve reliability, it may be beneficial to introduce a ",(0,r.jsx)(n.strong,{children:"failover mechanism"})," for feedback generation:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Configure a ",(0,r.jsx)(n.strong,{children:"secondary AI provider"})," (e.g., Claude, Gemini, or local LLM) as a fallback"]}),"\n",(0,r.jsx)(n.li,{children:"Automatically route requests there in case of timeout, quota exhaustion, or OpenAI downtime"}),"\n",(0,r.jsxs)(n.li,{children:["This ensures ",(0,r.jsx)(n.strong,{children:"graceful degradation"})," and uninterrupted user experience under stress"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"this-strategy-would-reduce-single-point-of-failure-risks-and-support-continuous-operation-in-production-environments",children:"This strategy would reduce single-point-of-failure risks and support continuous operation in production environments."}),"\n",(0,r.jsx)(n.h2,{id:"5-real-time-analytics-pipeline",children:"5. Real-Time Analytics Pipeline"}),"\n",(0,r.jsx)(n.p,{children:"We adopted a stream-processing architecture to enable real-time analysis:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Debezium"})," captures changes from PostgreSQL (CDC)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redpanda"})," transports events to ",(0,r.jsx)(n.strong,{children:"Bytewax"})]}),"\n",(0,r.jsx)(n.li,{children:"Bytewax processes sliding window metrics (e.g., avg. response length, unique words)"}),"\n",(0,r.jsxs)(n.li,{children:["Future: Store analytics in ",(0,r.jsx)(n.strong,{children:"ClickHouse"}),", visualize via ",(0,r.jsx)(n.strong,{children:"Grafana"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"-tech-stack-rationale",children:"\ud83d\udca1 Tech Stack Rationale"}),"\n",(0,r.jsxs)(n.p,{children:["Originally, a ",(0,r.jsx)(n.strong,{children:"Kafka + Flink"})," pipeline was considered. However:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Redpanda"})," was chosen for its ",(0,r.jsx)(n.strong,{children:"lower operational overhead"})," while retaining Kafka API compatibility"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Bytewax"})," was selected because it's written in ",(0,r.jsx)(n.strong,{children:"Python"}),", aligning with the rest of the backend"]}),"\n",(0,r.jsx)(n.li,{children:"Maintaining Flink (written in Scala/Java) for just one part of the pipeline would have added unnecessary complexity"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"this-setup-allows-for-tight-integration-faster-development-and-easier-onboarding-for-python-engineers",children:"This setup allows for tight integration, faster development, and easier onboarding for Python engineers."}),"\n",(0,r.jsx)(n.h2,{id:"6-scalability--future-proofing",children:"6. Scalability & Future-Proofing"}),"\n",(0,r.jsx)(n.p,{children:"To ensure the platform evolves smoothly:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Architecture supports ",(0,r.jsx)(n.strong,{children:"modular scaling"})," at each layer"]}),"\n",(0,r.jsx)(n.li,{children:"All services are containerized with Docker"}),"\n",(0,r.jsxs)(n.li,{children:["Infrastructure is managed via ",(0,r.jsx)(n.strong,{children:"Terraform + Ansible"})," (Future)"]}),"\n",(0,r.jsxs)(n.li,{children:["Monitoring is designed around ",(0,r.jsx)(n.strong,{children:"Prometheus, Loki, Grafana"})," (Future)"]}),"\n"]}),"\n",(0,r.jsxs)(n.blockquote,{children:["\n",(0,r.jsxs)(n.p,{children:["See the ",(0,r.jsx)(n.a,{href:"./overview",children:"System Overview"})," or ",(0,r.jsx)(n.a,{href:"./data-flow",children:"Data Flow"})," pages for visual diagrams and architectural context."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}}}]);